西田様

GPTでの偏向電磁石のテスト入力ファイルをお送りします
GPTでStartTestBend.batを実行すれば添付ファイル(TestBend_Z_X.PNG)のようなト
ラックが計算できます
ちょうど今設計していた加速器の分散部の配置
Benb->Quad->Quad->Bend
になってます

入力ファイルHitachiTestBend.inの中身ですが
1.まずccsで座標系を定義してます
24行目
ccs("wcs",0,0,L_linac,1,0,0,0,1,0,"c1");
これはグローバルな座標系"wcs”（World Coordinate System)で"c1"という座標系を
定義してます
原点(0,0,L_linac) (L_linacはファイルの中で0.3ｍに定義してます)、
新座標のx軸のベクトル(1,0,0) (ここではwcsのx軸のベクトルに等しい)
新座標のy軸のベクトル(0,1,0) (ここではwcsのy軸のベクトルに等しい)
c1座標系はベンドの入口を原点とした座標系としてます

25行目
ccs("c1",-ro*(1-cos(ang)),0,ro*sin(ang),cos(ang),0,sin(ang),0,1,0,"c2");
こちらはc1の座標系でc2を定義してます
roは軌道半径
angは偏向角で
c2はベンド出口を原点として角度angだけ回転した座標(ベンドの出口での進行方向を
z軸とした座標）になります
ここではx-z面内でビームが曲がるとしてますので
x軸のベクトルは(cos(ang),0,sin(ang))@c1
y軸のベクトルは変わらず(0,1,0)@c1
となってます

2．Bendを配置する
51行目
ccsflip("wcs","z",L_linac,"c1");
これはwcs座標系のz=L_linacのところでc1座標系に座標系を変える命令です
いろいろ試したんですがこれをいれないと上手く動作しなかったので入れてます
(GPTのサンプルファイルではccsflipを使ってないのでなくても動作はすると思うの
ですがこちらの思うようにベンドを入れられなかったので)

52行目
sectormagnet("c1","c2",ro,bf);
ベンドを実際に配置するルーチン
入口の座標系c1から出口の座標系c2の間に軌道半径ro、磁場の強さbfの偏向電磁石で
す
このルーチンをつかうとベンドの出口で座標系がc2に変わるみたいです(ccsflipと同
じ効果があるみたいです)
以後では座標系c2を使ってQuadを配置してます(58,59行目)

もし他に疑問がありましたらご連絡ください

よろしくお願いします。
==========================================
東北大学電子光理学研究センター
Research Center for Electron Photon Science, Tohoku University
武藤 俊哉
Toshiya Muto
〒982-0826
宮城県仙台市太白区三神峯1-2-1
tel: 022-743-3429 FAX: 022-743-3402
e-mail: muto@lns.tohoku.ac.jp
==========================================

